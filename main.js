(()=>{"use strict";var e=["inputErrorClass","errorClass"],t=["inputErrorClass","errorClass"],n=["inputSelector","submitButtonSelector"],r=["inputSelector","submitButtonSelector"],o=["formSelector"];function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i,s,l=function(n,r,o){r.validity.valid?function(e,n,r){var o=r.inputErrorClass,c=r.errorClass,u=(a(r,t),e.querySelector(".".concat(n.id,"-error")));n.classList.remove(o),u.classList.remove(c),u.textContent=""}(n,r,o):function(t,n,r,o){var c=o.inputErrorClass,u=o.errorClass,i=(a(o,e),t.querySelector(".".concat(n.id,"-error")));n.classList.add(c),i.textContent=r,i.classList.add(u)}(n,r,r.validationMessage,o)},d=function(e,t){console.log(e),function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!0:t.disabled=!1},p=function(e,t){var n=t.inputSelector,o=t.submitButtonSelector,c=a(t,r),u=Array.from(e.querySelectorAll(n)),i=e.querySelector(o);u.forEach((function(t){l(e,t,c),d(u,i)}))},f={formSelector:".popup__container_type_form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"},_=document.querySelector(".profile__name"),m=document.querySelector(".profile__subtitle"),h=document.querySelector(".profile__avatar"),y={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"8d39c875-e0dc-4420-9d25-ae2d27971d79","Content-type":"application/json"}},v=function(){return fetch("".concat(y.baseUrl,"/cards"),{headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},b=function(e){i=e,_.textContent=i.name,m.textContent=i.about,console.log(h.src),h.src=i.avatar,console.log(h.src)},S=function(e){console.log("setting cards"),G.textContent="",e.forEach((function(e){var t=G.appendChild(K(e)),n=t.querySelector(".card__delete-button"),r=t.querySelector(".card__like-button");e.likes.some((function(e){return e._id===i._id}))?r.classList.add("card__like-button_active"):r.classList.remove("card__like-button_active"),i._id===e.owner._id?n.classList.remove("card__delete-button_hidden"):n.classList.add("card__delete-button_hidden")})),console.log("set cards")},q=document.querySelector(".popup_type_photo"),g=document.querySelector(".popup_type_add-card"),k=document.querySelector(".popup_type_edit-profile"),E=document.querySelector(".popup_type_update_avatar"),j=document.querySelector(".popup_type_delete_card"),C=q.querySelector(".popup__photo"),O=q.querySelector(".popup__photo-caption"),P=k.querySelector(".popup__container"),L=g.querySelector(".popup__container"),x=E.querySelector(".popup__container"),w=j.querySelector(".popup__container"),D={editProfilePopup:k,addCardPopup:g,photoPopup:q,updateAvatarPopup:E,deleteCardPopup:j},U=P.elements["edit-profile-name"],A=P.elements["edit-profile-subtitle"],T=P.querySelector(".popup__submit"),B=g.querySelector(".popup__submit"),N=E.querySelector(".popup__submit"),J=x.elements["update-avatar-link"],H=L.elements["add-card-name"],z=L.elements["add-card-link"],I=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");F(t)}},M=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",I)},F=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",I)},G=document.querySelector(".cards"),K=function(e){var t=document.querySelector("#card_template").content.firstElementChild.cloneNode(!0),n=t.querySelector(".card__image"),r=t.querySelector(".card__image-container"),o=t.querySelector(".card__title"),c=t.querySelector(".card__like-amount");n.src=e.link,n.alt="Фотография места ".concat(e.name),c.textContent=e.likes.length,r.addEventListener("click",(function(){return function(e){C.src=e.link,C.alt=e.name,O.textContent=e.name,M(q)}(e)}));var u=t.querySelector(".card__like-button");return u.addEventListener("click",(function(){var t;console.log(u),u.classList.contains("card__like-button_active")?function(e){return fetch("".concat(y.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e._id).then((function(){return v()})).then((function(e){console.log(e),S(e)})).catch((function(e){return console.log(e)})):(t=e._id,fetch("".concat(y.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){return v()})).then((function(e){console.log(e),S(e)})).catch((function(e){return console.log(e)}))})),t.querySelector(".card__delete-button").addEventListener("click",(function(){var t;t=e._id,s=t,M(D.deleteCardPopup)})),o.textContent=e.name,t},Q=document.querySelector(".profile__edit-button"),R=document.querySelector(".profile__add-button"),V=document.querySelector(".profile__avatar-button");Q.addEventListener("click",(function(){T.textContent="Сохранить",M(k),U.value=_.textContent,A.value=m.textContent,p(P,f)})),P.addEventListener("submit",(function(e){var t,n;e.preventDefault(),T.textContent="Сохранение...",(t=U.value,n=A.value,fetch("".concat(y.baseUrl,"/users/me"),{method:"PATCH",headers:y.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){b(e),F(k)})).catch((function(e){return console.log(e)}))})),R.addEventListener("click",(function(){B.textContent="Сохранить",M(g)})),L.addEventListener("submit",(function(e){e.preventDefault();var t,n,r,o={name:H.value,link:z.value};B.textContent="Сохранение...",(t=o,n=t.name,r=t.link,fetch("".concat(y.baseUrl,"/cards"),{method:"POST",headers:y.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=K(e);G.prepend(t),L.reset(),B.disabled=!0,F(g)})).catch((function(e){return console.log(e)}))})),w.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=s,fetch("".concat(y.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){return v()})).then((function(e){S(e),F(j)})).catch((function(e){return console.log(e)}))})),Object.keys(D).forEach((function(e){D[e].addEventListener("mousedown",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close-button"))&&F(D[e])}))})),V.addEventListener("click",(function(){N.textContent="Сохранить",M(E),J.value=h.src,p(x,f)})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),N.textContent="Сохранение...",(t=J.value,fetch("".concat(y.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:y.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){b(e),F(E)})).catch((function(e){return console.log(e)}))})),function(e){var t=e.formSelector,r=a(e,o);Array.from(document.querySelectorAll(t)).forEach((function(e){return function(e,t){var r=t.inputSelector,o=t.submitButtonSelector,c=a(t,n),u=Array.from(e.querySelectorAll(r)),i=e.querySelector(o);d(u,i),u.forEach((function(t){t.addEventListener("input",(function(){l(e,t,c),d(u,i)}))}))}(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({formSelector:t},r))}))}(f),fetch("".concat(y.baseUrl,"/users/me"),{headers:y.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return b(e),v()})).then((function(e){S(e)})).catch((function(e){return console.log(e)}))})();